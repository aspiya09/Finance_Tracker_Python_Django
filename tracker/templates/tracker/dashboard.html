{% extends 'tracker/base.html' %} {% load static %} {% block content %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'tracker/dashboard.css' %}" />
    <title>Dashboard - Finance Tracker</title>
  </head>
  <body>
    <h1>Welcome, {{ user.username }}</h1>

    <h2>Balance: à§³{{ balance }}</h2>
    <h3>Income: à§³{{ income }} | Expense: à§³{{ expense }}</h3>

    <div class="summary-table">
      <h2>ðŸ“Š Monthly Summary</h2>
      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>Month</th>
            <th>Income (à§³)</th>
            <th>Expense (à§³)</th>
            <th>Net (à§³)</th>
          </tr>
        </thead>
        <tbody>
          {% for month, data in summary_dict.items %}
          <tr>
            <td>{{ month }}</td>
            <td>{{ data.income }}</td>
            <td>{{ data.expense }}</td>
            <td>{{ data.balance|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div
      style="
        background: #f9f9ff;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 0 10px #ccc;
        font-family: Nunito;
        margin: 2rem auto;
        width: 60%;
        text-align: center;
      "
    >
      <h2 style="margin-bottom: 0.5rem">Monthly Summary (AI Generated)</h2>
      <p>{{ summary }}</p>
    </div>

    <hr />

    <!-- Filters -->
    <form class="filter-form" method="get" style="margin-bottom: 20px">
      <input
        type="text"
        name="q"
        placeholder="Search by title"
        value="{{ search_query }}"
      />
      <label>Type:</label>
      <select name="type">
        <option value="">All</option>
        <option value="income">Income</option>
        <option value="expense">Expense</option>
      </select>

      <label>Category:</label>
      <select name="category">
        <option value="">All</option>
        <option value="food">Food</option>
        <option value="rent">Rent</option>
        <option value="travel">Travel</option>
        <option value="salary">Salary</option>
        <option value="other">Other</option>
      </select>

      <label>Payment:</label>
      <select name="payment_type">
        <option value="">All</option>
        <option value="cash">Cash</option>
        <option value="card">Card</option>
        <option value="mobile">Mobile Banking</option>
        <option value="other">Other</option>
      </select>

      <button type="submit">Filter</button>
      <a href="{% url 'dashboard' %}"><button type="button">Reset</button></a>
    </form>

    <h3>Your Finances:</h3>
    <table border="1" class="finance-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Category</th>
          <th>Payment</th>
          <th>Date</th>
          <th>Note</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for f in finances %}
        <tr>
          <td class="title">{{ f.title }}</td>
          <td>à§³{{ f.amount }}</td>
          <td>{{ f.type }}</td>
          <td>{{ f.category }}</td>
          <td>{{ f.payment_type }}</td>
          <td class="notes">{{ f.date }}</td>
          <td class="title">{{ f.notes }}</td>
          <td>
            <a href="{% url 'edit_finance' f.id %}">Edit</a> |
            <a href="{% url 'delete_finance' f.id %}">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8">No records found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="export">
      <a href="{% url 'export_csv' %}">
        <button>Export to CSV</button>
      </a>
    </div>

    {% endblock %}
  </body>
</html>
